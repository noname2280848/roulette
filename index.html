<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>IdentityVルーレット</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin: 20px; }
    h1, h2 { font-size: 24px; margin-top: 30px; }
    button { font-size: 18px; padding: 10px; margin: 10px; }
    .result { font-size: 20px; margin: 10px; }
    textarea { width: 90%; height: 100px; font-family: monospace; margin-top: 10px; }
  </style>
</head>
<body>

  <h1>IdentityVルーレット</h1>

  <!-- ハンタールーレット -->
  <h2>ハンタールーレット</h2>
  <div class="result" id="hunterResult">ハンター：？？？</div>
  <button onclick="spinHunter()">ハンタールーレットを回す！</button>

  <!-- サバイバールーレット -->
  <h2>サバイバールーレット</h2>
  <div class="result" id="survivorResult">サバイバー：？？？</div>
  <button onclick="spinSurvivor()">サバイバールーレットを回す！</button>

  <!-- マップルーレット -->
  <h2>マップルーレット</h2>
  <div class="result" id="mapResult">マップ：？？？</div>
  <button onclick="spinMap()">マップルーレットを回す！</button>

  <!-- 休憩ルーレット -->
  <h2>休憩ルーレット（順番）</h2>
  <textarea id="breakInput" placeholder="名前をカンマ区切りで入力（例：太郎、花子、次郎）"></textarea><br>
  <button onclick="spinBreak()">休憩順を決める</button>
  <div class="result" id="breakResult"></div>

  <!-- チーム分けルーレット -->
  <h2>チーム分けルーレット</h2>
  <textarea id="teamInput" placeholder="名前をカンマ区切りで入力（例：太郎、花子、次郎）"></textarea><br>
  <button onclick="makeTeams()">チーム分けを開始！</button>
  <div class="result" id="teamResult"></div>

  <!-- 抽選履歴 -->
  <h2>抽選履歴</h2>
  <textarea id="history" readonly></textarea>

  <script>
    const hunters = [
      "レオ", "ピエロ", "鹿", "リッパー", "蜘蛛", "芸者", "白黒", "ジョゼフ",
      "バルク", "ハスター", "魔女", "泣き虫", "ルキノ", "女王", "ボンボン", "アン",
      "アントニオ", "ガラテア", "アンデッド", "ウィル", "グレイス", "蝋人形師", "悪夢",
      "キーガン", "隠者", "イタカ", "サングリア", "フルゴ", "アイビィ", "足萎え",
      "フラバルー", "雑貨商"
    ];

    const survivors = [
      "医師", "弁護士", "泥棒", "庭師", "マジシャン", "冒険家", "傭兵", "空軍", "祭司",
      "機械技師", "オフェンス", "心眼", "調香師", "カウボーイ", "踊り子", "占い師", "納棺師",
      "探鉱者", "呪術師", "野人", "曲芸師", "一等航海士", "バーメイド", "ポストマン",
      "墓守", "囚人", "昆虫学者", "画家", "バッツマン", "玩具職人", "患者", "心理学者",
      "小説家", "少女", "泣きピエロ", "教授", "骨董商", "作曲家", "記者", "航空エンジニア",
      "応援団", "人形師", "レディファウロ", "騎士", "気象学者", "弓使い", "脱出マスター", "幸運児",
    ];

    const maps = [
      "軍需工場", "聖心病院", "赤の教会", "湖景村", "月の河公園", "レオの思い出", "永眠町", "中華街"
    ];

    let lastSmallTeam = [];

    function spinHunter() {
      const result = hunters[Math.floor(Math.random() * hunters.length)];
      document.getElementById("hunterResult").textContent = "ハンター： " + result;
      addHistory("[ハンター] → " + result);
    }

    function spinSurvivor() {
      const result = survivors[Math.floor(Math.random() * survivors.length)];
      document.getElementById("survivorResult").textContent = "サバイバー： " + result;
      addHistory("[サバイバー] → " + result);
    }

    function spinMap() {
      const result = maps[Math.floor(Math.random() * maps.length)];
      document.getElementById("mapResult").textContent = "マップ： " + result;
      addHistory("[マップ] → " + result);
    }

    function spinBreak() {
      const input = document.getElementById("breakInput").value;
      const names = input.split("、").map(n => n.trim()).filter(n => n);
      const shuffled = names.sort(() => Math.random() - 0.5);
      const result = shuffled.map((name, i) => `${i + 1}番目：${name}`).join("\n");
      document.getElementById("breakResult").textContent = result;
      addHistory("[休憩順] → \n" + result);
    }

    function makeTeams() {
      const input = document.getElementById("teamInput").value;
      let members = input.split("、").map(n => n.trim()).filter(n => n);

      if (members.length < 2) {
        document.getElementById("teamResult").textContent = "メンバーを2人以上入力してください。";
        return;
      }

      let teams = [];

    
        members = shuffleArray(members);

        // 前回の小チームのメンバーを5人チームに優先的に入れる
        const bigTeams = [];
        const others = [...members];

        while (others.length > 0) {
          let team = [];
          while (team.length < 5 && others.length > 0) {
            let name;
            if (lastSmallTeam.length > 0) {
              name = others.find(n => lastSmallTeam.includes(n)) || others[0];
            } else {
              name = others[0];
            }
            team.push(name);
            others.splice(others.indexOf(name), 1);
          }
          bigTeams.push(team);
        }

        lastSmallTeam = bigTeams[bigTeams.length - 1].length < 5 ? bigTeams[bigTeams.length - 1] : [];
        teams = bigTeams;
      

      let result = "";
      teams.forEach((team, i) => {
        result += `チーム${i + 1}： ${team.join(", ")}\n`;
      });

      document.getElementById("teamResult").textContent = result.trim();
      addHistory("[チーム分け] → \n" + result.trim());
    }

    function shuffleArray(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    function addHistory(text) {
      const history = document.getElementById("history");
      history.value += text + "\n";
      history.scrollTop = history.scrollHeight;
    }
  </script>
</body>
</html>

